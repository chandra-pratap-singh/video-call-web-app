"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[608],{608:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Z});var i=n(286),o=n(792);const s="socket:room:generated",c="socket:room:joined",r="received:remote:stream",a="connection:state:changed",d="connection:terminated",h="connection:steps:completed",l="video:track:toggle",C="audio:track:toggle",g="screen:sharing:toggled",f="screen:sharing:inactive",m=({icon:e,onclick:t})=>i.Z`
    <button class="button-icon" onclick=${t}><${e} /></button>
  `,v=()=>i.Z`<svg
    width="32"
    height="34"
    viewBox="0 0 32 34"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M15.9998 19.8333C14.8887 19.8333 13.9443 19.4201 13.1665 18.5937C12.3887 17.7673 11.9998 16.7639 11.9998 15.5833V7.08331C11.9998 5.90276 12.3887 4.89929 13.1665 4.0729C13.9443 3.24651 14.8887 2.83331 15.9998 2.83331C17.1109 2.83331 18.0554 3.24651 18.8332 4.0729C19.6109 4.89929 19.9998 5.90276 19.9998 7.08331V15.5833C19.9998 16.7639 19.6109 17.7673 18.8332 18.5937C18.0554 19.4201 17.1109 19.8333 15.9998 19.8333ZM14.6665 29.75V25.3937C12.3554 25.0632 10.4443 23.9653 8.93317 22.1C7.42206 20.2347 6.6665 18.0625 6.6665 15.5833H9.33317C9.33317 17.543 9.98339 19.2138 11.2838 20.5955C12.5843 21.9772 14.1563 22.6676 15.9998 22.6666C17.8443 22.6666 19.4167 21.9758 20.7172 20.5941C22.0176 19.2123 22.6674 17.5421 22.6665 15.5833H25.3332C25.3332 18.0625 24.5776 20.2347 23.0665 22.1C21.5554 23.9653 19.6443 25.0632 17.3332 25.3937V29.75H14.6665Z"
      fill="#DDDDDD"
    />
  </svg> `,u=()=>i.Z` <svg
    width="32"
    height="32"
    viewBox="0 0 32 32"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M0 8C0 5.79375 1.59444 4 3.55556 4H17.7778C19.7389 4 21.3333 5.79375 21.3333 8V24C21.3333 26.2062 19.7389 28 17.7778 28H3.55556C1.59444 28 0 26.2062 0 24V8ZM31.0611 6.2375C31.6389 6.5875 32 7.2625 32 8V24C32 24.7375 31.6389 25.4125 31.0611 25.7625C30.4833 26.1125 29.7833 26.075 29.2333 25.6625L23.9 21.6625L23.1111 21.0688V10.9312L23.9 10.3375L29.2333 6.3375C29.7778 5.93125 30.4778 5.8875 31.0611 6.2375Z"
      fill="#DDDDDD"
    />
  </svg>`,p=()=>i.Z`<svg
    width="36"
    height="36"
    viewBox="0 0 36 36"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <circle cx="18" cy="18" r="18" fill="#9D2D2D" />
    <path
      d="M21.3749 23.5687C20.9905 22.7766 20.4936 22.2 19.6358 22.5516L17.9436 23.1797C16.5889 23.8078 15.9139 23.1797 15.2342 22.2328L12.1874 15.3047C11.8077 14.5125 12.0046 13.7672 12.8624 13.4156L15.2296 12.4687C16.0874 12.1125 15.9514 11.3719 15.5671 10.5797L13.5467 6.80156C13.1624 6.00937 12.3749 5.81718 11.5171 6.16875C9.79674 6.87656 8.37643 7.9875 7.45768 9.63281C6.33268 11.6437 6.89518 14.4422 7.12018 15.6187C7.34518 16.7953 8.13268 18.8578 9.14987 20.9719C10.1671 23.0906 11.0624 24.7547 11.8592 25.6969C12.6561 26.6391 14.5686 29.2172 16.9358 29.7937C18.8764 30.2625 20.9717 29.8687 22.6874 29.1609C23.5452 28.8094 23.5499 28.0641 23.1655 27.2672L21.3749 23.5687ZM28.9405 12.4547L27.0936 10.6078L24.3233 13.3781L21.553 10.6078L19.7061 12.4547L22.4764 15.225L19.7061 18L21.553 19.8469L24.3233 17.0766L27.0936 19.8469L28.9405 18L26.1702 15.2297L28.9405 12.4547Z"
      fill="#DDDDDD"
    />
  </svg>`,w=()=>i.Z`<svg
    width="32"
    height="32"
    viewBox="0 0 32 32"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M28.4444 15.1579H25.4222C25.4222 16.4042 25.1378 17.5663 24.6578 18.6105L26.8444 20.6821C27.84 19.0316 28.4444 17.1621 28.4444 15.1579ZM21.2978 15.4442C21.2978 15.3432 21.3333 15.2589 21.3333 15.1579V5.05263C21.3333 2.25684 18.9511 0 16 0C13.0489 0 10.6667 2.25684 10.6667 5.05263V5.35579L21.2978 15.4442ZM2.25778 1.68421L0 3.82316L10.6844 13.9453V15.1579C10.6844 17.9537 13.0489 20.2105 16 20.2105C16.3911 20.2105 16.7822 20.16 17.1556 20.0758L20.1067 22.8716C18.8444 23.4274 17.44 23.7474 16 23.7474C11.0933 23.7474 6.57778 20.2105 6.57778 15.1579H3.55556C3.55556 20.9011 8.39111 25.6505 14.2222 26.4758V32H17.7778V26.4758C19.3956 26.2568 20.9244 25.7179 22.2933 24.96L29.7422 32L32 29.8611L2.25778 1.68421Z"
      fill="#DDDDDD"
    />
  </svg> `,L=()=>i.Z`<svg
    width="32"
    height="32"
    viewBox="0 0 32 32"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M4.37321 2.96C4.28166 2.86175 4.17126 2.78295 4.0486 2.72829C3.92593 2.67364 3.79351 2.64425 3.65924 2.64188C3.52497 2.63951 3.3916 2.66421 3.26708 2.7145C3.14257 2.7648 3.02945 2.83966 2.93449 2.93462C2.83954 3.02958 2.76468 3.14269 2.71438 3.2672C2.66409 3.39172 2.63939 3.52509 2.64176 3.65936C2.64413 3.79364 2.67352 3.92605 2.72817 4.04872C2.78283 4.17138 2.86163 4.28179 2.95988 4.37333L5.04921 6.46267C4.33259 6.82393 3.73036 7.37711 3.30967 8.06054C2.88897 8.74397 2.66632 9.5308 2.66655 10.3333V21.6667C2.66655 22.8159 3.12309 23.9181 3.93575 24.7308C4.74841 25.5435 5.85061 26 6.99988 26H16.9999C17.9803 26 18.9318 25.6676 19.699 25.0571C20.4662 24.4466 21.0037 23.5941 21.2239 22.6387L27.6252 29.0413C27.8128 29.2289 28.0672 29.3343 28.3325 29.3343C28.5978 29.3343 28.8523 29.2289 29.0399 29.0413C29.2275 28.8537 29.3329 28.5993 29.3329 28.334C29.3329 28.0687 29.2275 27.8143 29.0399 27.6267L4.37321 2.96ZM22.6665 18.424L28.6719 24.4307C28.8732 24.3132 29.0402 24.145 29.1562 23.9429C29.2723 23.7408 29.3333 23.5117 29.3332 23.2787V8.72C29.3333 8.46538 29.2605 8.21606 29.1234 8.00151C28.9863 7.78696 28.7906 7.61616 28.5595 7.5093C28.3284 7.40244 28.0715 7.36398 27.8192 7.39849C27.5669 7.43299 27.3298 7.53901 27.1359 7.704L22.6665 11.504V18.424ZM10.2425 6L21.3332 17.0907V10.3333C21.3332 9.18406 20.8767 8.08186 20.064 7.26921C19.2514 6.45655 18.1492 6 16.9999 6H10.2425Z"
      fill="#DDDDDD"
    />
  </svg>`;var k=n(177);const D=class{eventMap={[s]:[],[a]:[],[c]:[],[r]:[],[d]:[],[h]:[],[l]:[],[C]:[],[g]:[],[f]:[]};roomId;peerConnection;socket;logger;peerConnectionList;localStream;isSendingOffer=!1;_registerLogger(e,t,n){const i=t.emit;t.emit=function(e,...o){n(`Outgoing event: ${e} `,...o),i.apply(t,[e,...o])},t.onAny(((e,...t)=>{n(`Incoming event: ${e} `,...t)})),e.addEventListener("connectionstatechange",(()=>{n("Peer connection event: ",e.connectionState)}))}_joinRoom(e,t){e.emit("join:socket:room",t)}_connect(){this.peerConnection.addEventListener("icecandidate",(e=>{e.candidate&&this.socket.emit("new:ice:candidate",e.candidate,this.roomId)})),this.socket.on("new:ice:candidate:received",(async e=>{if(e&&("have-remote-offer"===this.peerConnection.iceConnectionState||"have-local-offer"===this.peerConnection.iceConnectionState))try{await this.peerConnection.addIceCandidate(e)}catch(e){this.logger("Error adding received ice candidate",e)}})),this.peerConnection.addEventListener("track",(e=>{const[t]=e.streams;this.remoteStream=t,this._executeEvenListereners(r,{remoteStream:t})})),this.peerConnection.addEventListener("negotiationneeded",(()=>{this._sendOffer()})),this.peerConnection.addEventListener("connectionstatechange",(()=>{this.logger("Peer connection: ",this.peerConnection.connectionState),this._executeEvenListereners(a,{peerConnection:this.peerConnection.connectionState})})),this.socket.on("socket:room:generated",(async e=>{this.roomId=e,this._executeEvenListereners(s,{roomId:e})})),this.socket.on("new:user:joined",(async()=>{await this._sendOffer()})),this.socket.on("received:answer",(async e=>{const t=new RTCSessionDescription(e);await this.peerConnection.setRemoteDescription(t),this.socket.emit("answer:accepted",this.roomId)})),this.socket.on("connection:steps:completed",(()=>{this._executeEvenListereners(h)})),this.socket.on("received:offer",(async e=>{this.isSendingOffer||"stable"!==this.peerConnection.signalingState||(this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),await this._sendAnswer())})),this.socket.on("received:negotiation:offer",(async e=>{this.peerConnection.setRemoteDescription(new RTCSessionDescription(e));const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),this.socket.emit("send:negotiation:answer",t,this.roomId)})),this.socket.on("received:negotiation:answer",(async e=>{const t=new RTCSessionDescription(e);await this.peerConnection.setRemoteDescription(t)})),this.socket.on("socket:room:joined",(()=>{this._executeEvenListereners(c)})),this.socket.on("end:call",(()=>{this._terminateConnection()})),this.socket.on("video:track:toggle",(e=>{this._executeEvenListereners(l,e)})),this.socket.on("audio:track:toggle",(e=>{this._executeEvenListereners(C,e)})),this.socket.on("screen:sharing:toggled",(e=>{this._executeEvenListereners(g,e)}))}constructor(e,t,n,i){this.peerConnection=e,this.socket=t,this.logger=n,this.roomId=i,this._registerLogger(e,t,n),this._connect(),this._joinRoom(t,i)}async _sendOffer(){try{this.isSendingOffer=!0,await this.peerConnection.setLocalDescription();const e=this.peerConnection.localDescription;this.socket.emit("send:offer",e,this.roomId)}catch(e){console.error(e)}finally{this.isSendingOffer=!1}}async _sendAnswer(){await this.peerConnection.setLocalDescription();const e=this.peerConnection.localDescription;this.socket.emit("send:answer",e,this.roomId)}_executeEvenListereners(e,t){this.eventMap[e].forEach((e=>e(t)))}_terminateConnection(){this.peerConnection.getSenders().forEach((e=>{e.track&&e.track.stop()})),this.peerConnection.close(),this._executeEvenListereners(d)}_setAudio(e){this.localStream.getAudioTracks().forEach((t=>{t.enabled=!!e})),this.socket.emit("audio:track:toggle",this.roomId,!!e)}_setVideo(e){this.localStream.getVideoTracks().forEach((t=>{t.enabled=!!e})),this.socket.emit("video:track:toggle",this.roomId,!!e)}async _shareStream(e=!0,t=!0){const n=await navigator.mediaDevices.getUserMedia({video:e,audio:t});this.localStream=n,this.localStream.getTracks().forEach((e=>{this.peerConnection.addTrack(e,this.localStream)}))}async shareScreen(){const e=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always",displaySurface:"monitor"}});if(e){this.screenStream=e;const t=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new MediaStream([...t.getTracks(),...this.screenStream.getTracks()]);this.audioAndScreenStream=n,n.getTracks().forEach((e=>{this.peerConnection.addTrack(e,this.screenStream),e.addEventListener("ended",(()=>{this._executeEvenListereners(f),this.socket.emit("screen:sharing:toggled",this.roomId,!1)}))})),this.socket.emit("screen:sharing:toggled",this.roomId,!0)}}stopSharingScreen(){this.screenStream?.getTracks().forEach((e=>{e.stop()})),this.socket.emit("screen:sharing:toggled",this.roomId,!1)}getRoomId(){return this.roomId}getLocalStream(){return this.localStream}getRemoteStream(){return this.remoteStream}muteAudio(){this._setAudio(!1)}unMuteAudio(){this._setAudio(!0)}muteVideo(){this._setVideo(!1)}unMuteVideo(){this._setVideo(!0)}endCall(){this.socket.emit("end:call:start",this.roomId)}async startVideo(){await this._shareStream(!0,!0)}on(e,t){this.eventMap[e].includes(t)||(this.eventMap[e]=[...this.eventMap[e],t])}off(e,t){this.eventMap[e]=this.eventMap[e].filter((e=>e!==t))}};var S=n(279);const V=({status:e})=>i.Z`<div class="d-flex flex-align-items-center h-100">
    <div class="text-center text-white">
      ${S.O[e].displayMessage}
    </div>
  </div>`,x=()=>i.Z`
    <svg
      width="32"
      height="32"
      viewBox="0 0 32 32"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M10.6666 18.6667H13.3333V16C13.3333 15.6222 13.4613 15.3053 13.7173 15.0493C13.9733 14.7933 14.2897 14.6658 14.6666 14.6667H17.3333V17.3333L21.3333 13.3333L17.3333 9.33334V12H14.6666C13.5555 12 12.611 12.3889 11.8333 13.1667C11.0555 13.9444 10.6666 14.8889 10.6666 16V18.6667ZM2.66659 28C2.28881 28 1.97192 27.872 1.71592 27.616C1.45992 27.36 1.33237 27.0436 1.33326 26.6667C1.33326 26.2889 1.46126 25.972 1.71726 25.716C1.97326 25.46 2.2897 25.3324 2.66659 25.3333H29.3333C29.711 25.3333 30.0279 25.4613 30.2839 25.7173C30.5399 25.9733 30.6675 26.2898 30.6666 26.6667C30.6666 27.0444 30.5386 27.3613 30.2826 27.6173C30.0266 27.8733 29.7101 28.0009 29.3333 28H2.66659ZM5.33326 24C4.59992 24 3.97192 23.7387 3.44926 23.216C2.92659 22.6933 2.6657 22.0658 2.66659 21.3333V6.66667C2.66659 5.93334 2.92792 5.30534 3.45059 4.78267C3.97326 4.26 4.60081 3.99911 5.33326 4H26.6666C27.3999 4 28.0279 4.26134 28.5506 4.784C29.0733 5.30667 29.3341 5.93422 29.3333 6.66667V21.3333C29.3333 22.0667 29.0719 22.6947 28.5493 23.2173C28.0266 23.74 27.399 24.0009 26.6666 24H5.33326ZM5.33326 21.3333H26.6666V6.66667H5.33326V21.3333Z"
        fill="#DDDDDD"
      />
    </svg>
  `,M=()=>i.Z`
    <svg
      width="32"
      height="32"
      viewBox="0 0 32 32"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M19.2334 15.4333L15.8 12H17.3334V9.33334L21.3334 13.3333L19.2334 15.4333ZM27.6 23.8L25.1333 21.3333H26.6667V6.66667H10.4667L7.80002 4H26.6667C27.4 4 28.028 4.26134 28.5507 4.784C29.0733 5.30667 29.3342 5.93423 29.3333 6.66667V21.3333C29.3333 21.9111 29.172 22.4164 28.8493 22.8493C28.5267 23.2822 28.1102 23.5991 27.6 23.8ZM27.3333 31.0667L24.2667 28H1.33335V25.3333H21.5667L20.2334 24H5.33335C4.60002 24 3.97202 23.7387 3.44935 23.216C2.92668 22.6933 2.66579 22.0658 2.66668 21.3333V6.46667L0.93335 4.66667L2.80002 2.8L29.2 29.2L27.3333 31.0667ZM13.3334 17.1333V18.6667H10.6667V16C10.6667 15.7556 10.6778 15.5222 10.7 15.3C10.7222 15.0778 10.7889 14.8667 10.9 14.6667L5.33335 9.1V21.3333H17.5333L13.3334 17.1333Z"
        fill="#DDDDDD"
      />
    </svg>
  `,Z=({roomId:e,redirectToPage:t})=>{const n=(0,o.Ye)((()=>{if(e)return(e=>{const t=(0,k.io)(),n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return new D(n,t,(function(...e){console.log(...e)}),e)})(e)}),[e]),s=(0,o.sO)(),c=(0,o.sO)(),[h,Z]=(0,o.eJ)(!1),[y,$]=(0,o.eJ)(!1),[_,H]=(0,o.eJ)(S.O.new.key),[E,I]=(0,o.eJ)(!0),[b,O]=(0,o.eJ)(!0),[T,A]=(0,o.eJ)(!1),[R,j]=(0,o.eJ)(),[J,B]=(0,o.eJ)(),[P,Y]=(0,o.eJ)(!1),U=()=>{const e=n.getLocalStream();B(e)};(0,o.d4)((()=>{if(n){function e(){const e=n.getRemoteStream();j(e)}return n.on(r,e),()=>{n.off(r,e)}}}),[]),(0,o.d4)((async()=>{if(n)try{await n.startVideo(),U()}catch(e){console.error("Error: ",e)}}),[]),(0,o.d4)((()=>{if(n){function e(){t(S.L.callEnded.pageId)}return n.on(d,e),()=>{n.off(d,e)}}}),[]),(0,o.d4)((()=>{if(n){function e({peerConnection:e}){H(e)}return n.on(a,e),()=>{n.off(a,e)}}}),[]),(0,o.d4)((()=>{if(n){function e(e){I(e)}return n.on(l,e),()=>{n.off(l,e)}}}),[]),(0,o.d4)((()=>{if(n){function e(e){O(e)}return n.on(C,e),()=>{n.off(C,e)}}}),[]),(0,o.d4)((()=>{if(n){function e(e){A(e)}return n.on(g,e),()=>{n.off(g,e)}}}),[]);const q=(0,o.I4)((async()=>{Y(!1),await n.startVideo(),U(),y&&(n.muteVideo(),$(!0)),h&&(n.muteAudio(),Z(!0))})),z=(0,o.I4)((async()=>{P?(await n.stopSharingScreen(),await q()):(await n.shareScreen(),Y(!0))}),[q]);(0,o.d4)((()=>{if(n){function e(){q()}return n.on(f,e),()=>{n.off(f,e)}}}),[q]);const F=(0,o.Ye)((()=>_===S.O.connected.key?(E||T)&&i.Z`<video
            ref=${c}
            id="remote-video-player"
            autoplay
            srcObject=${R}
            controls=${!1}
            class="h-100 max-w-100"
          ></video>`:i.Z`<${V} status=${_} />`),[_,E,c,R,T]),G=(0,o.Ye)((()=>y||P?null:i.Z`<div
          class="position-absolute position-bottom-right h-25 max-w-100"
        >
          <video
            ref=${s}
            id="local-video-player"
            autoplay
            muted
            controls=${!1}
            srcObject=${J}
            class="h-100 border-radius-l border-l-white"
          ></video>
        </div>`)),K=(0,o.Ye)((()=>{if(_===S.O.connected.key)return i.Z`<div
        class="position-absolute position-full-screen h-100 d-flex flex-centered 1"
      >
        ${b?null:i.Z` <${w} />`}
        ${E?null:i.Z` <${L} />`}
      </div>`}));return i.Z`<div
    class="full-page-container h-100 d-flex flex-direction-column background-dark"
  >
    <div class="position-relative flex-1">
      ${K}
      <div class="d-flex flex-centered h-100 max-w-100">
        ${F}
      </div>
      ${G}
    </div>
    <div class="background-gray d-flex flex-centered p-l">
      <div class="d-flex flex-justify-content-space-between w-50 m-w-100">
        <${m}
          icon=${P?x:M}
          onclick=${z}
        />
        <${m}
          icon=${h?w:v}
          onclick=${()=>{h?(n.unMuteAudio(),Z(!1)):(n.muteAudio(),Z(!0))}}
        />
        <${m}
          icon=${y?L:u}
          onclick=${()=>{y?(n.unMuteVideo(),$(!1)):(n.muteVideo(),$(!0))}}
        />
        <${m} icon=${p} onclick=${()=>{n.endCall(),location.assign("/")}} />
      </div>
    </div>
  </div>`}}}]);